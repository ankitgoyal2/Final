<!DOCTYPE html>
<html>

<head>

    <title> Emergency</title>
    <link rel = "icon" type = "image/png" href = "../img/patientIcon.png">

    <link rel="stylesheet" href="../css/register.css">
    <!-- <script src="../js/register.js"></script> -->
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="../https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="../css/forAll.css">
    <style>
        input[type=radio] {
            margin-right: 10px;
            margin-top: 10px;
            transform: scale(1.3);
        }

        .container {
            max-width: 100% !important;
        }


        #register {
            margin-top: 30px;
        }

        form {
            padding-top: 0px !important;
        }
    </style>

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="signup-form col-7">
                <form onsubmit="data();">
                    <h2>Select Location</h2>

                    

                    <div class="form-group">
                        <label for="map">Search your location</label>
                        <input type="text" id="map" name="map" placeholder="example: Delhi" class="form-control">
                    </div>
                    
                    <button id="find" onclick="getmap()" class="btn btn-lg btn-main btn-block">
                        Find Location
                    </button>

                    <div class="form-group">
                        <p id="res1"></p>
                        <p id="res2"></p>
                        



                    </div>
                    <p style="font-size:x-large;">or</p>
                    <!-- <div class="form-group ">
                        <label for="lat" style="font-size: larger;"> Use current Location</label>
                    
                        <div class="row">
                            <div class="form-group col-sm-6">
                                <label> Latitude</label>
                                <!-- <p class="form-control">Latitude <p id="latitude"></p></p> -->
                        <!--      <p id="LATITUDE" class="form-control"></p>
                            </div>
                    
                            <div class="form-group col-sm-6">
                                <label> Longitude</label>
                                <p id="LONGITUDE" class="form-control"></p>
                    
                            </div>
                    
                        </div>
                    </div> -->

                    <button onclick="getLocation();" class="btn btn-lg btn-main btn-block">
                        Use current Location
                    </button>

                    <div class="form-group">
                        <p>Distance</p>
                        <select id="distance" name="distance" class="form-control">
                            <option value="5">
                                <=5 KM</option>
                            <option value="10">
                                <=10 KM</option>

                            <option value="15">
                                <=15 KM</option>

                            <option value="20">
                                <=20 KM</option>
                            
                            <option value="1500">
                                >=20 KM</option>

                        </select>
                    </div>
                    

                    <button id="currentLocation"  class="btn btn-lg btn-main btn-block" type="submit">
                        Find Nearby Doctors
                    </button>
                    <hr>


                </form>
            </div>
        </div>
    </div>





    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



    <script>
        
        var choice = -1;
        var lat,long;
        
        function getLocation() {

            event.preventDefault();
            choice = 1;

            var x = document.getElementById("LATITUDE");
            var y = document.getElementById("LONGITUDE");
            
            function showPosition(position) {
                // x.innerText = position.coords.latitude;
                // y.innerText = position.coords.longitude;
                lat = position.coords.latitude;
                long = position.coords.longitude;
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else {
                window.alert('some error occured');
            }
        }

        

        
        function data() {

            event.preventDefault();

            if(choice==-1){
                window.alert('select an option first');
            }else{
                // var lat = document.getElementById("LATITUDE").innerText;
                // var long = document.getElementById("LONGITUDE").innerText;
                var distance = document.getElementById("distance").value;
                console.log(lat);
                console.log(long);

                localStorage.setItem('lat', lat);
                localStorage.setItem('long', long);
                localStorage.setItem('distance', distance);

                window.location = 'patient_emergency_select_doctor.html';
            } 
        }

        function getmap(){
            event.preventDefault();
            choice = 2;
            var address = document.getElementById('map').value;
            
            axios.get("http://nominatim.openstreetmap.org/search?q="+address+"&format=json")
            .then(res=>{
                console.log(res.data);
                var length = res.data.length;

                if(length==0){
                    document.getElementById('res1').innerText = "No Result Found";
                }
                else{
                    if(length>=2){
                        document.getElementById('res1').innerText = res.data[0].display_name;
                        document.getElementById('res2').innerText = res.data[1].display_name;
                    }
                    else{
                        document.getElementById('res1').innerText = res.data[0].display_name;
                    } 
                }
            })
            .catch(err=>{
                console.log(err);
                window.alert('some error occured');
            })
        }

    </script>
    
</body>

</html>